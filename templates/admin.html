{% extends "base.html" %}
{% block title %}Panel de administración - CodeTube{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
{% endblock %}

{% block content %}
<div class="admin-page">
  <h1>Panel de administración</h1>

  <section class="admin-section">
    <h2>Usuarios</h2>
    <table class="admin-table" id="usersTable">
      <thead><tr><th>Usuario</th><th>Email</th><th>Rol</th><th>Acciones</th></tr></thead>
      <tbody>
        {% for u in users %}
        <tr data-id="{{ u._id }}">
          <td>{{ u.username }}</td>
          <td>{{ u.email }}</td>
          <td class="role">{{ u.role or 'user' }}</td>
          <td>
            <button class="btn-role" data-role="{{ 'admin' if u.role != 'admin' else 'user' }}">
              {% if u.role == 'admin' %}Degradar{% else %}Promover{% endif %}
            </button>
            <button class="btn-delete-user">Eliminar</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="admin-section">
    <h2>Videos</h2>
    <table class="admin-table" id="videosTable">
      <thead><tr><th>Título</th><th>Autor</th><th>Fecha</th><th>Acciones</th></tr></thead>
      <tbody>
        {% for v in videos %}
        <tr data-id="{{ v._id }}">
          <td>{{ v.title }}</td>
          <td>{{ v.username }}</td>
          <td>{{ v.date }}</td>
          <td>
            <a class="btn-edit" href="{{ url_for('upload_page') }}?edit={{ v._id }}">Editar</a>
            <button class="btn-delete-video">Eliminar</button>
            <a class="btn-view" href="{{ url_for('video_page', video_id=v._id) }}" target="_blank">Ver</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="admin-section">
    <h2>Comentarios</h2>
    <table class="admin-table" id="commentsTable">
      <thead><tr><th>Autor</th><th>Comentario</th><th>Fecha</th><th>Acciones</th></tr></thead>
      <tbody>
        {% for c in comments %}
        <tr data-id="{{ c._id }}">
          <td>{{ c.author }}</td>
          <td style="max-width:600px; white-space:normal;">{{ c.text }}</td>
          <td>{{ c.created_at }}</td>
          <td><button class="btn-delete-comment">Eliminar</button></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='admin.js') }}"></script>
{% endblock %}